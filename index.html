<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ•°æ®å›¾è¡¨</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <canvas id="chartCanvas"></canvas>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <!-- å›¾è¡¨ç±»å‹ä¸‹æ‹‰æ¡† -->
        <div class="chart-type-selector">
            <label for="chartType">å›¾è¡¨ç±»å‹</label>
            <select id="chartType" class="chart-type-dropdown">
                <option value="line">ğŸ“ˆ æŠ˜çº¿å›¾</option>
                <option value="bar">ğŸ“Š æŸ±çŠ¶å›¾</option>
                <option value="pie">ğŸ¥§ é¥¼å›¾</option>
            </select>
        </div>
        
        <!-- æ•°æ®ç»Ÿè®¡é¢æ¿ -->
        <div class="data-info-panel">
            <div class="data-info-header">
                <h4>
                    <span>ğŸ“Š</span>
                    æ•°æ®ç»Ÿè®¡
                </h4>
                <span class="icon">â–¼</span>
            </div>
            <div class="data-info-content">
                <div class="data-stats">
                    <div class="stat-item">
                        <span class="stat-label">æ•°æ®ç‚¹:</span>
                        <span class="stat-value" id="dataPoints">6</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æœ€å¤§å€¼:</span>
                        <span class="stat-value" id="maxValue">81</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æœ€å°å€¼:</span>
                        <span class="stat-value" id="minValue">55</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¹³å‡å€¼:</span>
                        <span class="stat-value" id="avgValue">66.0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ€»å’Œ:</span>
                        <span class="stat-value" id="sumValue">396</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ ‡å‡†å·®:</span>
                        <span class="stat-value" id="stdValue">10.2</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="control-buttons">
            <button class="control-btn" id="randomDataBtn" title="ç”Ÿæˆéšæœºæ•°æ® (Ctrl+R)">éšæœºæ•°æ®</button>
            <button class="control-btn" id="exportBtn" title="å¯¼å‡ºå›¾è¡¨ä¸ºå›¾ç‰‡ (Ctrl+E)">å¯¼å‡ºå›¾ç‰‡</button>
        </div>
    </div>

    <!-- å·¥å…·æç¤º -->
    <div class="tooltip" id="tooltip"></div>

    <!-- æ¨¡å—åŒ–å›¾è¡¨è„šæœ¬ -->
    <script src="scripts/chart-utils.js"></script>
    <script src="scripts/chart-axes.js"></script>
    <script src="scripts/chart-core.js"></script>
    <script src="scripts/chart-interaction.js"></script>
    <script src="scripts/controls.js"></script>
    <script src="scripts/main.js"></script>
</body>
</html>
                    
                    // ç»˜åˆ¶æ ‡ç­¾çº¿
                    const labelX = centerX + Math.cos(midAngle) * (radius + 20);
                    const labelY = centerY + Math.sin(midAngle) * (radius + 20);
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX + Math.cos(midAngle) * radius, centerY + Math.sin(midAngle) * radius);
                    ctx.lineTo(labelX, labelY);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    
                    // ç»˜åˆ¶ç™¾åˆ†æ¯”æ ‡ç­¾
                    const percentage = ((value / total) * 100).toFixed(1);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.font = '12px Arial';
                    ctx.textAlign = Math.cos(midAngle) > 0 ? 'left' : 'right';
                    ctx.fillText(`${percentage}%`, labelX + (Math.cos(midAngle) > 0 ? 5 : -5), labelY + 4);
                    
                    startAngle += sliceAngle;
                });
            }
            
            switchChartType() {
                const types = ['line', 'bar', 'pie'];
                const currentIndex = types.indexOf(this.chartType);
                const newType = types[(currentIndex + 1) % types.length];
                this.setChartType(newType);
                
                // æ›´æ–°ä¸‹æ‹‰æ¡†
                document.getElementById('chartType').value = newType;
            }
            
            setChartType(type) {
                if (['line', 'bar', 'pie'].includes(type)) {
                    this.chartType = type;
                    this.drawChart();
                }
            }
            
            generateRandomData() {
                this.data = Array.from({length: 6}, () => Math.floor(Math.random() * 100) + 1);
                this.drawChart();
            }
            
            updateStats() {
                const maxValue = Math.max(...this.data);
                const minValue = Math.min(...this.data);
                const sumValue = this.data.reduce((a, b) => a + b, 0);
                const avgValue = (sumValue / this.data.length).toFixed(1);
                
                // è®¡ç®—æ ‡å‡†å·®
                const variance = this.data.reduce((acc, val) => acc + Math.pow(val - avgValue, 2), 0) / this.data.length;
                const stdValue = Math.sqrt(variance).toFixed(1);
                
                document.getElementById('dataPoints').textContent = this.data.length;
                document.getElementById('maxValue').textContent = maxValue;
                document.getElementById('minValue').textContent = minValue;
                document.getElementById('avgValue').textContent = avgValue;
                document.getElementById('sumValue').textContent = sumValue;
                document.getElementById('stdValue').textContent = stdValue;
            }
            
            exportChart() {
                const link = document.createElement('a');
                link.download = `chart-${this.chartType}-${new Date().getTime()}.png`;
                link.href = this.canvas.toDataURL();
                link.click();
            }
            
            // APIæ–¹æ³• - ä¾›åç«¯è°ƒç”¨
            updateData(newData) {
                if (Array.isArray(newData)) {
                    this.data = newData;
                    this.drawChart();
                }
            }
            
            switchType(type) {
                this.setChartType(type);
            }
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        let chart = new LocalChart('chartCanvas');
        
        // å…¨å±€å‡½æ•°ä¾›åç«¯è°ƒç”¨
        window.updateChart = function(data) {
            chart.updateData(data);
        };
        
        window.switchChart = function(type) {
            chart.switchType(type);
        };
    </script>
</body>
</html>